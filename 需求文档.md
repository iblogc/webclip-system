当然，以下是**根据你最新补充（仅使用一个 Markdown 输出目录）与此前讨论整合后的完整开发提示词（Dev Brief）**，适合团队协作、AI 编码辅助或任务拆解。

---

# ✅ Web 收藏转 Markdown 系统：开发提示词（Dev Brief）

## 🎯 项目目标

实现一个轻量化系统，用户可在浏览器中一键收藏网页链接，后台客户端（Mac/Windows）定期拉取任务，自动抓取网页内容、添加元信息与 AI 摘要，生成结构化 Markdown 文件，保存到本地指定目录并通过 Git 管理同步到 GitHub 仓库。

---

## 📦 系统架构

1. **网页提交模块**：浏览器油猴脚本，一键收藏当前标签页
2. **任务队列存储**：GitHub 私有 Gist
3. **客户端任务处理器**：Mac + Windows，定时运行脚本
4. **网页转 Markdown 模块**：Puppeteer + Readability + Turndown
5. **AI 内容增强模块**：调用 OpenAI 或 Gemini 接口生成摘要与标签
6. **文件管理与 Git 同步模块**：将 Markdown 保存并推送到远程仓库

---

## 1️⃣ 油猴脚本（网页端）

### ✅ 功能：

* 插入一个按钮或右键菜单项「📌 收藏网页」
* 点击后弹出 UI 表单，**符合 Apple HIG 设计规范**

  * 自动填充当前网页标题与 URL
  * 分类目录字段：支持手动输入或从**预设选项中选择**（不记录历史）

    ```js
    const CATEGORY_OPTIONS = ["阅读", "写作", "设计", "产品"];
    ```
  * 可选备注字段
* 用户点击“确认”后，将数据追加到 GitHub 私有 Gist，格式如下：

```json
{
  "items": [
    {
      "title": "网页标题",
      "url": "https://example.com",
      "category": "阅读",
      "note": "可选备注",
      "created": "2025-07-25T14:02:00Z"
    }
  ]
}
```

* 使用 `GM_xmlhttpRequest` 操作 Gist，支持 PATCH 更新
* 所有 Token、Gist ID、预设分类均为脚本中常量，不从外部读取

---

## 2️⃣ 云端任务队列（GitHub Gist）

* 用于存储任务队列，形式为一个私有 JSON Gist
* 客户端脚本定时拉取 Gist 内容，处理每条任务
* 成功后从 Gist 中移除已完成任务并更新内容

---

## 3️⃣ 客户端任务处理器（macOS / Windows）

### ✅ 通用流程：

1. 每 10 分钟定时执行：

   * macOS：使用 `launchd`
   * Windows：使用「任务计划程序」
2. 拉取 Gist，遍历任务项
3. 对每条任务执行网页解析与 Markdown 生成流程

---

## 4️⃣ 网页转 Markdown 流程

### ✅ 技术栈：

* `Puppeteer`: 加载网页、支持 SPA 页面
* `Readability.js`: 提取正文内容
* `Turndown`: 将正文 HTML 转为 Markdown

### ✅ Frontmatter 内容（插入于 Markdown 顶部）：

```yaml
---
title: 网页标题
url: https://example.com
created: 2025-07-25T15:22:00Z
category: 阅读
note: 可选备注
tags: [标签1, 标签2, 标签3]
summary: |
  AI 自动摘要内容
---
```

### ✅ Markdown 文件结构：

```md
---
（Frontmatter）
---

## 正文内容（Readability 提取结果）

...
```

---

## 5️⃣ AI 内容增强模块

### ✅ 功能：

* 调用 AI 模型生成：

  * 简明摘要（Summary）
  * 关键词标签（Tags，最多 5 个）

### ✅ 配置与调用逻辑：

* 配置文件中按顺序定义多个 Provider：

```json
{
  "ai": {
    "providers": [
      { "type": "openai", "api_key": "..." },
      { "type": "gemini", "api_key": "..." },
      { "type": "openai", "api_key": "..." }
    ]
  }
}
```

* 调用顺序：

  * 自动依次尝试，每个请求失败后切换下一个 provider
  * 所有 AI 请求统一封装为 `summarize(content)` 函数，内部判断并选择 provider

---

## 6️⃣ Markdown 输出与 Git 同步

### ✅ 文件输出：

* 所有 `.md` 文件统一保存到一个本地目录：

```json
{
  "output_dir": "~/Documents/KnowledgeRepo"
}
```

* 每条任务根据 `category` 分类，文件名为：

```
<output_dir>/<category>/2025-07-25-标题.md
```

* 保存后执行如下 Git 操作自动同步：

```bash
git add .
git commit -m "新增网页记录：<title>"
git push
```

---

## ⚙️ 配置文件格式（config/config.json）

```json
{
  "gist_id": "your-gist-id",
  "github_token": "your-github-token",
  "output_dir": "~/Documents/KnowledgeRepo",
  "ai": {
    "providers": [
      { "type": "openai", "api_key": "..." },
      { "type": "gemini", "api_key": "..." }
    ]
  }
}
```

---

## 💄 UI 设计要求

* 所有界面（如油猴脚本弹窗）必须遵循 Apple Human Interface Guidelines：

  * 使用 `-apple-system` 字体
  * 自然圆角、柔和阴影
  * 高对比度、简约配色
  * 支持亮/暗色模式

---

## 📂 推荐项目结构

```
webclip-system/
├── oilmonkey/
│   └── clip-to-gist.user.js
├── config/
│   └── config.json
├── client/
│   ├── process_gist.js
│   ├── summarize.js
│   └── markdown-builder.js
├── launchd/
│   └── webclip.plist
├── win-task/
│   └── webclip.xml
├── sync-to-github.sh
└── README.md
```

---

## 🧪 错误处理建议

* 所有请求需支持超时、重试和错误日志
* Markdown 写入失败时保存副本到 `errors/` 子目录
* Gist 更新失败应打印异常并跳过该任务，不阻塞其他处理

---

## ✅ 总结：核心原则

| 要素          | 实现方式                       |
| ----------- | -------------------------- |
| 网页提交        | 油猴脚本 → GitHub Gist         |
| 网页解析        | Puppeteer + Readability.js |
| Markdown 生成 | Turndown + Frontmatter     |
| AI 摘要与标签    | OpenAI / Gemini（可配置切换）     |
| 文件保存 + Git  | 保存至一个目录并自动同步               |
| 任务调度        | Launchd（Mac）/ 任务计划（Win）    |
| 配置管理        | 全部集中在 `config/config.json` |
